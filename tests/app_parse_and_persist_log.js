const { parseAndPersistLog } = require('../app');

const json = { "level": "info", "ts": 1739204436.2671442, "logger": "http.log.access.log2", "msg": "handled request", "request": { "remote_ip": "41.45.33.64", "remote_port": "61350", "client_ip": "41.45.33.64", "proto": "HTTP/2.0", "method": "GET", "host": "domain.com", "uri": "/flutter_service_worker.js?v=2835424944", "headers": { "Referer": ["https://domain.com/flutter_service_worker.js?v=2835424944"], "Cookie": ["REDACTED"], "Accept": ["*/*"], "Accept-Encoding": ["gzip, deflate, br, zstd"], "Sec-Fetch-Dest": ["serviceworker"], "Sec-Fetch-Site": ["same-origin"], "Sec-Fetch-Mode": ["same-origin"], "Accept-Language": ["en-GB,en;q=0.9,en-US;q=0.8,ar;q=0.7"], "Cache-Control": ["max-age=0"], "Service-Worker": ["script"], "User-Agent": ["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"], "Priority": ["u=4, i"] }, "tls": { "resumed": false, "version": 772, "cipher_suite": 4865, "proto": "h2", "server_name": "domain.com" } }, "bytes_read": 0, "user_id": "", "duration": 0.002600911, "size": 555, "status": 404, "resp_headers": { "Alt-Svc": ["h3=\":443\"; ma=2592000"], "Date": ["Mon, 10 Feb 2025 16:20:36 GMT"], "Content-Type": ["text/html"], "Content-Length": ["555"], "Server": ["Caddy", "nginx/1.27.3"] } };;

parseAndPersistLog(JSON.stringify(json)).then((r) => { console.log(JSON.stringify(r)) });
